<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚²ãƒ¼ãƒ /ã‚«ãƒ†ã‚´ãƒª çµ±ä¸€ãƒã‚§ãƒƒã‚¯</title>
  <style>
    body { font-family: sans-serif; background: #f9fff9; padding: 20px; }
    pre { background: #fff; padding: 12px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); white-space: pre-wrap; }
    .err { color: #b00020; font-weight: 700; }
  </style>
</head>
<body>
  <h1>ğŸ“‹ ã‚²ãƒ¼ãƒ /ã‚«ãƒ†ã‚´ãƒª çµ±ä¸€ãƒã‚§ãƒƒã‚¯</h1>
  <div id="result">èª­ã¿è¾¼ã¿ä¸­...</div>

  <script>
    // âœ… æ±ç”¨ normalizeï¼ˆå¿…è¦ã«å¿œã˜ã¦åŒç¾©èªã‚’è¿½åŠ ï¼‰
    const normalize = (s = "") =>
      String(s)
        .toLowerCase()
        .replace(/\s|ã€€/g, "")
        .replace(/[ï¼â€•â€”â€“]/g, "-")
        .trim();

    (async () => {
      const result = document.getElementById("result");
      try {
        const res = await fetch("rules.json");
        const rules = await res.json();

        const gameMap = {};
        const categoryMap = {}; // gameNorm -> { catNorm -> Set(originalCats) }
        const bad = [];

        for (const r of rules) {
          const rawGame = (r.game || "").trim();
          const rawCat  = (r.category || "").trim();
          if (!rawGame) bad.push(`id=${r.id} ã« game ãŒã‚ã‚Šã¾ã›ã‚“`);
          if (!rawCat)  bad.push(`id=${r.id} ã« category ãŒã‚ã‚Šã¾ã›ã‚“`);

          const gNorm = normalize(rawGame);
          const cNorm = normalize(rawCat);

          if (rawGame) {
            if (!gameMap[gNorm]) gameMap[gNorm] = new Set();
            gameMap[gNorm].add(rawGame);
          }

          if (rawGame && rawCat) {
            if (!categoryMap[gNorm]) categoryMap[gNorm] = {};
            if (!categoryMap[gNorm][cNorm]) categoryMap[gNorm][cNorm] = new Set();
            categoryMap[gNorm][cNorm].add(rawCat);
          }
        }

        let out = "";

        if (bad.length) {
          out += "âš ï¸ æ¬ æãƒã‚§ãƒƒã‚¯\n";
          out += bad.map(x => `- ${x}`).join("\n");
          out += "\n\n";
        }

        out += "âœ… ã‚²ãƒ¼ãƒ å çµ±ä¸€ãƒã‚§ãƒƒã‚¯\n";
        for (const [gNorm, originals] of Object.entries(gameMap)) {
          out += `ãƒ»çµ±ä¸€å¾Œ: ${gNorm}\n`;
          out += `ã€€â”— åŸæ–‡: ${Array.from(originals).join(", ")}\n`;
        }
        out += "\n";

        out += "âœ… ã‚«ãƒ†ã‚´ãƒª çµ±ä¸€ãƒã‚§ãƒƒã‚¯ï¼ˆã‚²ãƒ¼ãƒ åˆ¥ï¼‰\n";
        for (const [gNorm, cats] of Object.entries(categoryMap)) {
          out += `\nã€${gNorm}ã€‘\n`;
          for (const [cNorm, originals] of Object.entries(cats)) {
            out += `ãƒ»çµ±ä¸€å¾Œ: ${cNorm}\n`;
            out += `ã€€â”— åŸæ–‡: ${Array.from(originals).join(", ")}\n`;
          }
        }

        result.innerHTML = `<pre>${out}</pre>`;
      } catch (e) {
        result.innerHTML = `<p class="err">rules.json ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚</p>`;
        console.error(e);
      }
    })();
  </script>
</body>
</html>
